<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claude Sessions</title>
    <link rel="stylesheet" href="styles.css?v=8">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header>
        <h1>Claude Code Sessions</h1>
        <div id="status">
            <span id="session-count">0 sessions</span>
            <span id="last-update">--</span>
            <button id="sound-toggle" class="icon-button" onclick="soundManager.toggle(); soundManager.updateMuteIndicator(); showToast(soundManager.enabled ? 'ğŸ”Š Sound enabled' : 'ğŸ”‡ Sound muted');" title="Toggle sound (M)">
                ğŸ”Š
            </button>
            <button id="sound-settings" class="icon-button" onclick="showSoundSettings()" title="Sound settings (Shift+S)">
                âš™ï¸
            </button>
            <button id="analytics-button" class="icon-button" title="Analytics" onclick="toggleAnalytics()">
                ğŸ“Š
            </button>
            <button id="machines-button" class="icon-button" title="Manage machines" onclick="showMachinesModal()">
                ğŸ–¥ï¸
            </button>
            <span id="machine-count" class="machine-count"></span>
            <button id="notification-toggle" class="icon-button" title="Toggle notifications">
                ğŸ””
            </button>
        </div>
    </header>

    <nav class="view-tabs">
        <div class="tab-indicator"></div>
        <button class="tab-button active" onclick="switchView('sessions')" data-view="sessions">
            Sessions
        </button>
        <button class="tab-button" onclick="switchView('gastown')" data-view="gastown">
            ğŸ­ Gastown
        </button>
        <button class="tab-button" onclick="switchView('timeline')" data-view="timeline">
            Timeline
        </button>
        <button class="tab-button" onclick="switchView('analytics')" data-view="analytics">
            Analytics
        </button>
        <button class="tab-button" onclick="switchView('mission-control')" data-view="mission-control">
            ğŸ›ï¸ Mission Control
        </button>
        <button class="tab-button" onclick="switchView('graveyard')" data-view="graveyard">
            ğŸª¦ Graveyard
        </button>
    </nav>

    <div id="main-content" role="main">
    <div id="sessions-view" class="view active">
        <div id="filters">
            <input type="text" id="search" placeholder="ğŸ” Search sessions...">
            <select id="status-filter">
                <option value="all">All Sessions</option>
                <option value="active">Active Only</option>
                <option value="waiting">Waiting Only</option>
            </select>
            <button id="clear-filters">Clear</button>
            <div class="filter-divider"></div>
            <button id="view-mode-toggle" class="icon-button" onclick="toggleCardMode()" title="Toggle compact/detailed view (v)">ğŸ“‹</button>
            <button id="focus-mode-toggle" class="icon-button" onclick="toggleFocusMode()" title="Focus on active sessions (f)">ğŸ¯</button>
            <button id="refresh-sessions" class="icon-button" onclick="forceRefreshSessions()" title="Refresh all session data">ğŸ”„</button>
        </div>
        <main id="sessions-container"></main>
    </div>

    <div id="gastown-view" class="view">
        <div class="gastown-view-header">
            <h2>ğŸ­ Gastown Agents</h2>
            <span id="gastown-count" class="gastown-stats"></span>
        </div>
        <main id="gastown-container"></main>
    </div>

    <div id="timeline-view" class="view">
        <div class="timeline-header">
            <h2>Session Timeline</h2>
            <div class="timeline-controls">
                <select id="timeline-range-select" class="timeline-range-select" onchange="changeTimelineRange(this.value)">
                    <option value="1">Last 1 hour</option>
                    <option value="2">Last 2 hours</option>
                    <option value="4">Last 4 hours</option>
                    <option value="8" selected>Last 8 hours</option>
                    <option value="12">Last 12 hours</option>
                    <option value="24">Last 24 hours</option>
                    <option value="48">Last 2 days</option>
                </select>
                <button class="refresh-btn" onclick="refreshTimeline()" title="Refresh timeline">ğŸ”„</button>
            </div>
        </div>
        <div class="timeline-legend">
            <span class="legend-item"><span class="legend-dot active"></span> Active</span>
            <span class="legend-item"><span class="legend-dot waiting"></span> Waiting</span>
            <span class="legend-item"><span class="legend-dot closed"></span> Closed</span>
        </div>
        <div id="timeline-container" class="timeline-container">
            <div class="timeline-loading">Loading timeline...</div>
        </div>
    </div>

    <div id="analytics-view" class="view">
        <div class="analytics-header">
            <h2>Usage Analytics</h2>
            <div class="period-selector">
                <button class="period-btn" data-period="day">Today</button>
                <button class="period-btn active" data-period="week">Week</button>
                <button class="period-btn" data-period="month">Month</button>
                <button class="period-btn" data-period="year">Year</button>
            </div>
        </div>
        <div id="analytics-container"></div>
    </div>

    <div id="mission-control-view" class="view">
        <div class="mission-control-header">
            <h2>ğŸ›ï¸ Mission Control</h2>
            <div class="mission-control-status">
                <span id="mc-connection-status" class="mc-status-indicator">â— Disconnected</span>
                <button id="mc-refresh" class="icon-button" title="Refresh">ğŸ”„</button>
            </div>
        </div>
        <div class="mission-control-grid">
            <div class="mc-panel mc-sessions-panel">
                <div class="mc-panel-header">
                    <h3>Active Sessions</h3>
                    <div class="mc-panel-header-actions">
                        <span id="mc-active-count" class="mc-count">0</span>
                        <button id="mc-spawn-btn" class="mc-spawn-btn" onclick="showSpawnModal()" title="Spawn new Claude session">
                            + New
                        </button>
                    </div>
                </div>
                <div id="mc-sessions-list" class="mc-panel-content">
                    <div class="mc-empty">No active sessions</div>
                </div>
            </div>
            <div class="mc-panel mc-conversation-panel">
                <div class="mc-panel-header">
                    <h3 id="mc-panel-title">Live Conversation</h3>
                    <div class="mc-panel-header-right">
                        <span id="mc-session-type" class="mc-session-type-badge hidden"></span>
                        <span id="mc-selected-session" class="mc-selected-label">Select a session</span>
                        <button id="mc-kill-btn" class="mc-kill-btn hidden" onclick="killSelectedProcess()" title="Stop process">
                            Stop
                        </button>
                    </div>
                </div>
                <div id="mc-conversation-stream" class="mc-panel-content mc-conversation-stream">
                    <div class="mc-empty">Select a session to view conversation</div>
                </div>
                <div id="mc-terminal-output" class="mc-panel-content mc-terminal-output hidden">
                    <div class="mc-terminal-content"></div>
                </div>
                <div id="mc-input-container" class="mc-input-container hidden">
                    <div class="mc-input-wrapper">
                        <div id="mc-input" class="mc-input" contenteditable="true"
                             data-placeholder="Type a message..." spellcheck="false"></div>
                        <button id="mc-send-btn" class="mc-send-btn" title="Send (Cmd+Enter)">â¤</button>
                    </div>
                    <div class="mc-input-hints">
                        <span>Cmd+Enter to send</span>
                        <span id="mc-input-status"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Spawn Session Modal -->
    <div id="spawn-modal" class="spawn-modal hidden">
        <div class="spawn-modal-content">
            <div class="spawn-modal-header">
                <h3>Spawn New Claude Session</h3>
                <button class="spawn-modal-close" onclick="hideSpawnModal()">&times;</button>
            </div>
            <div class="spawn-modal-body">
                <div class="spawn-input-group">
                    <label for="spawn-directory">Working Directory</label>
                    <div class="spawn-directory-input">
                        <input type="text" id="spawn-directory" placeholder="/path/to/project"
                               onkeydown="if(event.key==='Enter') spawnSession()">
                        <button class="spawn-browse-btn" onclick="document.getElementById('spawn-directory').focus()" title="Type or paste path">
                            ğŸ“
                        </button>
                    </div>
                </div>
                <div class="spawn-recent-dirs">
                    <label>Recent Directories</label>
                    <div id="spawn-recent-list" class="spawn-recent-list">
                        <div class="spawn-loading">Loading...</div>
                    </div>
                </div>
            </div>
            <div class="spawn-modal-footer">
                <button class="spawn-cancel-btn" onclick="hideSpawnModal()">Cancel</button>
                <button class="spawn-confirm-btn" onclick="spawnSession()">Spawn Session</button>
            </div>
        </div>
    </div>

    <div id="graveyard-view" class="view">
        <div class="graveyard-header">
            <h2>ğŸª¦ Session Graveyard</h2>
            <div class="graveyard-controls">
                <div class="graveyard-search-container">
                    <input type="text" id="graveyard-search" class="graveyard-search"
                           placeholder="Search sessions..."
                           onkeydown="if(event.key==='Enter') searchGraveyard()">
                    <button class="search-btn" onclick="searchGraveyard()" title="Search">ğŸ”</button>
                    <button id="graveyard-clear-search" class="clear-search-btn hidden"
                            onclick="clearGraveyardSearch()" title="Clear search">âœ•</button>
                    <label class="search-content-toggle" title="Search conversation content (slower)">
                        <input type="checkbox" id="graveyard-search-content">
                        <span>Deep</span>
                    </label>
                </div>
                <select id="graveyard-range-select" class="graveyard-range-select" onchange="refreshGraveyard()">
                    <option value="1">Last 1 hour</option>
                    <option value="2">Last 2 hours</option>
                    <option value="4">Last 4 hours</option>
                    <option value="8">Last 8 hours</option>
                    <option value="24" selected>Last 24 hours</option>
                    <option value="48">Last 2 days</option>
                    <option value="168">Last 7 days</option>
                </select>
                <button class="refresh-btn" onclick="refreshGraveyard()" title="Refresh graveyard">ğŸ”„</button>
                <span id="graveyard-count" class="graveyard-count">0 sessions</span>
            </div>
        </div>
        <div id="graveyard-container" class="graveyard-container">
            <div class="graveyard-loading">Loading dead sessions...</div>
        </div>
    </div>
    </div> <!-- end main-content -->

    <!-- Modal for keyboard shortcuts and other dialogs -->
    <div id="modal-overlay" class="modal-overlay hidden">
        <div id="modal-content" class="modal-content"></div>
    </div>
    <script src="app.js?v=13"></script>
</body>
</html>
